# Apache cache-control + SPA routing for static deployment

# Safety
Options -Indexes

# Disable caching for HTML files (always get fresh version)
<FilesMatch "\.(html)$">
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires "0"
</FilesMatch>

# Cache static assets with hashes for 1 year (immutable)
<FilesMatch "\.(js|css|woff2?|ttf|eot|svg|png|jpg|jpeg|gif|ico|webp)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
</FilesMatch>

# Enable gzip compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css application/javascript application/json
</IfModule>

# Correct MIME types (some shared hosts are missing these)
<IfModule mod_mime.c>
    AddType application/javascript .js
    AddType text/css .css
    AddType application/wasm .wasm
    AddType application/json .json
    AddType image/svg+xml .svg
    AddType font/woff2 .woff2
    AddType font/woff .woff
    AddType application/octet-stream .bin
    AddType application/octet-stream .onnx
    AddType application/octet-stream .data
    AddType application/octet-stream .pack
    AddType application/octet-stream .safetensors
    AddType application/octet-stream .gguf
    AddType application/octet-stream .ggml
    AddType application/octet-stream .model
    AddType application/octet-stream .weights
    AddType application/octet-stream .params
</IfModule>

# SPA fallback - redirect all non-file requests to index.html
<IfModule mod_rewrite.c>
    RewriteEngine On
    # Don't rewrite files or directories
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    
    # Rewrite everything else to index.html
    RewriteRule ^ index.html [L]
</IfModule>
